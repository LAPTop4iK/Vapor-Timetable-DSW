# VPS Operations Guide

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–±–æ—Ç–µ —Å DSW Timetable –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–Ω–∞-—Å–µ—Ä–≤–µ—Ä–µ)
2. [–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫](#–ø–µ—Ä–≤—ã–π-–∑–∞–ø—É—Å–∫)
3. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–∫–æ–¥–∞)
4. [–†–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-–ª–æ–≥–∞–º–∏)
5. [–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#—Ä–∞–±–æ—Ç–∞-—Å-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞–º–∏)
7. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
8. [–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö](#—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-–¥–∞–Ω–Ω—ã—Ö)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
10. [Troubleshooting](#troubleshooting)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/srv/app/
‚îú‚îÄ‚îÄ .env                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (DB –ø–∞—Ä–æ–ª–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
‚îú‚îÄ‚îÄ docker-compose.yml        # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îú‚îÄ‚îÄ certs/               # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf           # Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ redeploy.sh              # –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ build-sync.sh        # –°–±–æ—Ä–∫–∞ SyncRunner
‚îÇ   ‚îú‚îÄ‚îÄ run-sync.sh          # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ setup-cron.sh        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ vapor/                   # Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    ‚îú‚îÄ‚îÄ Sources/
    ‚îú‚îÄ‚îÄ Package.swift
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ Dockerfile.sync
    ‚îî‚îÄ‚îÄ ...
```

---

## –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```bash
cd /srv/app
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
nano .env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `DB_PASSWORD`:
```bash
DB_PASSWORD=your_secure_password_here
DB_USER=vapor
DB_NAME=dsw_timetable
DSW_BACKEND_MODE=cached
DSW_DEFAULT_FROM=2025-09-06
DSW_DEFAULT_TO=2026-02-08
SYNC_DELAY_GROUPS_MS=150
SYNC_DELAY_TEACHERS_MS=100
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: `Ctrl+O`, `Enter`, `Ctrl+X`

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
cd /srv/app/vapor
./redeploy.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–¥—Ç—è–Ω–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–¥ –∏–∑ Git
- –°–∫–æ–ø–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (PostgreSQL, Vapor API, nginx)

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å—ë –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
```bash
cd /srv/app
docker compose ps
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `healthy` –∏–ª–∏ `running`.

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–µ—Ä–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
```bash
./scripts/run-sync.sh
```

–≠—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏ –≥—Ä—É–ø–ø –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ Git –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
cd /srv/app/vapor
./redeploy.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–¥–µ–ª–∞–µ—Ç `git pull`
2. –û–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑—ã
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ç–∫–∏
```bash
cd /srv/app/vapor
git fetch origin
git checkout claude/review-commit-fix-011CUd9oTmdJgWh6VZAiiXL3
git pull origin claude/review-commit-fix-011CUd9oTmdJgWh6VZAiiXL3
./redeploy.sh
```

---

## –†–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
cd /srv/app
docker compose logs
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```bash
# API —Å–µ—Ä–≤–µ—Ä (Vapor)
docker compose logs vapor

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
docker compose logs postgres

# Nginx
docker compose logs nginx
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (follow)
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose logs -f

# –¢–æ–ª—å–∫–æ Vapor API
docker compose logs -f vapor

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –∏ follow
docker compose logs -f --tail=100 vapor
```

### –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª
```bash
# –í—Å–µ –ª–æ–≥–∏
docker compose logs > all-logs.txt

# –¢–æ–ª—å–∫–æ Vapor –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
docker compose logs --since 1h vapor > vapor-recent.log
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω cron)
```bash
tail -f /srv/app/sync-cron.log
```

---

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ psql
```bash
cd /srv/app

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker compose exec postgres psql -U vapor -d dsw_timetable
```

### –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∫–æ–º–∞–Ω–¥—ã

#### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
```sql
\dt
```

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø –≤ –±–∞–∑–µ
```sql
SELECT COUNT(*) FROM groups;
```

#### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
```sql
SELECT COUNT(*) FROM teachers;
```

#### –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```sql
SELECT * FROM sync_status ORDER BY timestamp DESC LIMIT 1;
```

#### –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
```sql
SELECT
    timestamp,
    status,
    total_groups,
    processed_groups,
    failed_groups,
    duration
FROM sync_status
ORDER BY timestamp DESC
LIMIT 10;
```

#### –ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø—ã
```sql
SELECT group_id, group_info FROM groups WHERE group_info::text LIKE '%sem%';
```

#### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≥—Ä—É–ø–ø–µ
```sql
SELECT * FROM groups WHERE group_id = 1234;
```

#### –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø (—Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞)
```sql
SELECT group_id, group_info->'name' as name FROM groups ORDER BY group_id;
```

#### –í—ã—Ö–æ–¥ –∏–∑ psql
```sql
\q
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
cd /srv/app

# –ü–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker compose exec postgres pg_dump -U vapor dsw_timetable > backup-$(date +%Y%m%d-%H%M%S).sql

# –î–∞–º–ø —Å —Å–∂–∞—Ç–∏–µ–º
docker compose exec postgres pg_dump -U vapor dsw_timetable | gzip > backup-$(date +%Y%m%d-%H%M%S).sql.gz
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
```bash
cd /srv/app

# –ò–∑ –æ–±—ã—á–Ω–æ–≥–æ –¥–∞–º–ø–∞
cat backup-20250130-120000.sql | docker compose exec -T postgres psql -U vapor -d dsw_timetable

# –ò–∑ —Å–∂–∞—Ç–æ–≥–æ –¥–∞–º–ø–∞
gunzip -c backup-20250130-120000.sql.gz | docker compose exec -T postgres psql -U vapor -d dsw_timetable
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
docker compose exec postgres psql -U vapor -d dsw_timetable

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –≥—Ä—É–ø–ø—ã
TRUNCATE TABLE groups CASCADE;

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
TRUNCATE TABLE teachers CASCADE;
TRUNCATE TABLE groups_list CASCADE;
TRUNCATE TABLE sync_status CASCADE;
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
cd /srv/app
docker compose ps
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker compose up -d
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker compose down
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes (–û–°–¢–û–†–û–ñ–ù–û - —É–¥–∞–ª–∏—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!)
```bash
docker compose down -v
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API
docker compose restart vapor

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ë–î
docker compose restart postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
docker compose restart nginx
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞)
```bash
# –¢–æ–ª—å–∫–æ Vapor API
docker compose up -d --build vapor

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d --build
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker stats

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker stats dsw-postgres
docker stats vapor
docker stats nginx
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
```bash
cd /srv/app
nano .env
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
DB_PASSWORD=your_secure_password      # –ü–∞—Ä–æ–ª—å PostgreSQL
DB_USER=vapor                         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_NAME=dsw_timetable                 # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```

#### –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã API
```bash
# cached - —á–∏—Ç–∞—Ç—å –∏–∑ PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
# live - –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Å —Å–∞–π—Ç–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
DSW_BACKEND_MODE=cached
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ–º–µ—Å—Ç—Ä–∞ (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
```bash
DSW_DEFAULT_FROM=2025-09-06    # –ù–∞—á–∞–ª–æ —Å–µ–º–µ—Å—Ç—Ä–∞
DSW_DEFAULT_TO=2026-02-08      # –ö–æ–Ω–µ—Ü —Å–µ–º–µ—Å—Ç—Ä–∞
```

#### Throttling —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞)
```bash
SYNC_DELAY_GROUPS_MS=150       # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ (–º—Å)
SYNC_DELAY_TEACHERS_MS=100     # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏ (–º—Å)
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env
```bash
cd /srv/app

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
docker compose down
docker compose up -d
```

---

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
cd /srv/app
./scripts/run-sync.sh
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü–æ–ª—É—á–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø
2. –î–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–ª—É—á–∏—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
3. –°–æ–±–µ—Ä–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç –≤—Å—ë –≤ PostgreSQL

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~30-60 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥—Ä—É–ø–ø.

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
docker logs -f $(docker ps -q --filter ancestor=dsw-sync-runner:latest)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (cron)
```bash
cd /srv/app
./scripts/setup-cron.sh
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 –Ω–æ—á–∏**.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å crontab
crontab -e

# –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É:
# 0 3 * * * /srv/app/scripts/run-sync.sh >> /srv/app/sync-cron.log 2>&1

# –§–æ—Ä–º–∞—Ç: –º–∏–Ω—É—Ç–∞ —á–∞—Å –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏ –∫–æ–º–∞–Ω–¥–∞
# –ü—Ä–∏–º–µ—Ä—ã:
# 0 2 * * *     - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
# 0 */6 * * *   - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
# 0 0 * * 0     - –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ –ø–æ–ª–Ω–æ—á—å
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
crontab -e
# –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Å run-sync.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
tail -f /srv/app/sync-cron.log
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è API
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ API –æ—Ç–≤–µ—á–∞–µ—Ç
curl http://localhost/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
curl http://localhost/groups/search?q=sem
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PostgreSQL
```bash
docker compose exec postgres pg_isready -U vapor
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
```bash
docker compose exec postgres psql -U vapor -d dsw_timetable -c "SELECT COUNT(*) FROM groups;"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
```bash
# –û–±—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker
docker system df

# –†–∞–∑–º–µ—Ä volumes
docker volume ls -q | xargs docker volume inspect | grep -A 5 Mountpoint
```

### –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö Docker —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes (–û–°–¢–û–†–û–ñ–ù–û!)
docker volume prune

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Å–µ—Ç–∏, volumes)
docker system prune -a --volumes
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ 1**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
docker compose logs vapor
```

**–†–µ—à–µ–Ω–∏–µ 2**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ DB_PASSWORD —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```bash
grep DB_PASSWORD /srv/app/.env
```

**–†–µ—à–µ–Ω–∏–µ 3**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
```bash
docker compose exec postgres psql -U vapor -d dsw_timetable -c "SELECT 1;"
```

### –ü—Ä–æ–±–ª–µ–º–∞: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –∏–ª–∏ 502

**–†–µ—à–µ–Ω–∏–µ 1**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Vapor –∑–∞–ø—É—â–µ–Ω
```bash
docker compose ps vapor
```

**–†–µ—à–µ–Ω–∏–µ 2**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
docker compose exec nginx nginx -t
```

**–†–µ—à–µ–Ω–∏–µ 3**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ nginx
```bash
docker compose logs nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ 1**: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
```bash
./scripts/run-sync.sh
```

**–†–µ—à–µ–Ω–∏–µ 2**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω
```bash
docker images | grep dsw-sync-runner
```

**–†–µ—à–µ–Ω–∏–µ 3**: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
cd /srv/app/vapor
docker build -f Dockerfile.sync -t dsw-sync-runner:latest .
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ 1**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```bash
cat /srv/app/.env | grep DB_PASSWORD
```

**–†–µ—à–µ–Ω–∏–µ 2**: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
docker compose down
docker volume rm app_postgres_data  # –û–°–¢–û–†–û–ñ–ù–û - —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
docker compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∞–ª–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ 1**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```bash
df -h
docker system df
```

**–†–µ—à–µ–Ω–∏–µ 2**: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ Docker
sudo sh -c 'echo "" > $(docker inspect --format="{{.LogPath}}" vapor)'
sudo sh -c 'echo "" > $(docker inspect --format="{{.LogPath}}" dsw-postgres)'
```

**–†–µ—à–µ–Ω–∏–µ 3**: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ Docker –æ–±—Ä–∞–∑—ã
```bash
docker image prune -a -f
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ HTTPS

**–†–µ—à–µ–Ω–∏–µ 1**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ nginx –∑–∞–ø—É—â–µ–Ω
```bash
docker compose ps nginx
```

**–†–µ—à–µ–Ω–∏–µ 2**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
```bash
ls -la /srv/app/nginx/certs/
```

**–†–µ—à–µ–Ω–∏–µ 3**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
```bash
sudo ufw status
sudo ufw allow 443/tcp
```

---

## –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
cd /srv/app/vapor && ./redeploy.sh

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ API
cd /srv/app && docker compose logs -f vapor

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
cd /srv/app && ./scripts/run-sync.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
cd /srv/app && docker compose ps

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
cd /srv/app && docker compose exec postgres psql -U vapor -d dsw_timetable

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API
cd /srv/app && docker compose restart vapor

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
cd /srv/app && nano .env

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î
cd /srv/app && docker compose exec postgres pg_dump -U vapor dsw_timetable > backup.sql
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã
- **80** - HTTP (nginx)
- **443** - HTTPS (nginx)
- **5432** - PostgreSQL (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker network)
- **8080** - Vapor API (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker network)

### Docker Networks
- `app_app-network` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å –¥–ª—è —Å–≤—è–∑–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### Docker Volumes
- `app_postgres_data` - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Vapor: https://docs.vapor.codes
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL: https://www.postgresql.org/docs/
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Docker Compose: https://docs.docker.com/compose/
